# 2팀 이커머스 서비스 요구사항 분석

---

> 이커머스 서비스 기본 과제에 명시되어있는 요구사항을 토대로 
> 필요 도메인 및 기능을 산출하였습니다.

## 도메인 및 기능

---

### ✅ 사용자(User)
→ 사용자 정보와 포인트 관리를 위한 도메인
- 사용자는 고유의 식별값을 가진다.
- 사용자는 각자의 잔액을 보유하고있으며 사용자 식별값을 통해 현재 잔액을 조회할 수 있다.
  - 잔액은 상품 결제 시 사용(차감)된다.
- 사용자의 잔액은 충전 할 수 있다.
  - 잔액 충전은 최소 충전 금액(100원) 이상의 경우 충전 가능하다.
  - 잔액 충전 후 보유 잔액은 최대 보유 잔액(100,000,000원)을 초과할 수 없다.


### ✅ 상품(Item)
→ 상품 정보와 잔여 수량 관리를 위한 도메인
- 상품은 고유의 식별값을 가진다.
- 상품은 이름, 가격, 잔여 수랑에 해당하는 정보를 가진다.
- 상품의 잔여 수량은 변동될 수 있다.
  - 상품 주문 결제 완료 시 주문 수량 만큼 재고 수량이 차감된다.

    
### ✅ 쿠폰(Coupon)
→ 쿠폰 생성과 (선착순)발급을 위한 도메인
- 쿠폰은 고유의 식별값을 가진다.
- 쿠폰은 만료일을 가질 수 있다.
- 쿠폰은 선착순으로 발급된다.
  - 쿠폰은 발행 한정 수량을 가진다.
- 쿠폰을 사용할 경우 전체 금액에 대하여 할인 혜택을 받을 수 있다.
  - 할인 혜택 종류: % 할인, 정액 할인

### ✅ 사용자 쿠폰(User Coupon)
→ 발급받은 쿠폰 정보와 할인 혜택 적용을 위한 도메인
- 사용자 쿠폰은 고유의 식별값을 가진다.
- 사용자에게 발급된 쿠폰은 귀속된다.
- 유효한 쿠폰은 결제 시 사용할 수 있다.
  - 기한 만료 이전 쿠폰
  - 사용하지 않은 쿠폰
- 결제 시 사용자 쿠폰을 사용하면 할인 혜택을 받을 수 있다.

### ✅ 주문(Order)
→ 상품 주문을 위한 주문 정보, 주문 상품 정보를 관리하고 결제 요청을 위한 도메인
- 주문은 고유의 식별값을 가진다.
- 주문 생성을 위해서는 주문 요청 사용자(N:1)의 식별값과 주문 상품(1:M)의 (식별값, 주문 수량)이 필요한다.
  - 상품의 재고가 부족할 경우 주문을 생성할 수 없다.
- 주문은 상태 구분값을 가진다.
  - 주문 생성, 결제 대기, 결제 완료
- 주문 생성 시 주문 상품의 재고에서 주문 수량만큼 차감된다.
- 생성된 주문은 결제를 위한 정보로 사용된다.
  - 주문은 주문 상품과 수량을 통해 총 결제 금액을 계산한다.

### ✅ 결제(Payment)
→ 결제 요청을 처리하기 위한 도메인
- 결제는 고유의 식별값을 가진다.
- 결제는 반드시 하나의 주문에 대해서 처리될 수 있다. (1:1)
- 결제 금액은 사용자 쿠폰 할인 혜택 적용을 받을 수 있다.
- 결제에 성공하면 사용자의 잔액에서 결제 금액만큼 차감된다.
  - 사용자 잔액이 부족할 경우 결제에 실패한다.
- ~~결제에 성공하면 상품의 잔고가 상품 주문 수량만큼 차감된다.~~
  - ~~상품 잔고가 부족할 경우 결제에 실패한다.~~
- 결제에 성공할 경우 데이터 플랫폼에 실시간 주문 정보를 전송한다.


### ✅ 판매 통계(Order Statistic)
→ 상품 판매량 통계 관리를 위한 도메인
- 하루에 한 번씩 작일 판매 상품에 대한 통계가 생성된다.
- 판매 통계는 통계 집계일, 판매 상품 고유 번호, 해당 상품 총 판매 수량이 저장된다.

## 추가 고려 사항

---
-[ ] 주문 / 결제 과정에서 상품 재고 및 잔액 차감 시점
  - 현재 주문이 성공적으로 생성된 경우 주문 상품의 재고 수량을 차감한다. 이 경우 결제 과정 진행에서 상품의 재고 여부 검증 없이 사용자 잔액 검증 진행 후 결제 처리, 처리 완료 후 사용자 잔액 차감 만을 수행하여 결제를 완료할 수 있음
    - 이 경우 사용자가 주문을 생성한 뒤 결제를 진행하지 않을 경우 미결제 재고 수량으로 잡히게 되는 문제가 발생
  - 결제 완료 시점 이후 상품 재고 차감을 진행할 경우 결제 생성 시 상품 재고와 사용자 잔액 검증을 모두 진행해야함
    - 이 경우 미결제 재고가 잡히는 문제점을 발생하지 않지만 사용자 입장에서 주문 생성 시 주문 가능했던 상품이 재고 부족으로 결제 시점에 취소될 수 있음
- [ ] 할인 쿠폰 적용 시점
  - 주문 생성 시 할인 쿠폰 적용 여부를 전달받아 최종 결제 금액을 계산, 이후 결제에서는 추가 할인율 계산 없이 결제만 진행
  - 주문 생성 시 상품의 총 결제 금액만 계산하여 결제에 전달, 결제 과정에서 할인 쿠폰이 적용 될 경우 할인율을 계산하여 최종 결제금액 만큼 계산